<dataConfig>
    <dataSource
        driver="org.postgresql.Driver"
        url="jdbc:postgresql://qwc-postgis/threerivers" user="postgres" password="postgis" />
    <document>
        <entity name="trdc_road_name" query="
            WITH index_base AS (
                /* ==== Base query for search index ==== */
                SELECT
                    'trdc_road_name'::text AS subclass,
                    gid AS id_in_class,
                    'gid' AS id_name,
                    'int:n' AS id_type,
                    &#34;SITE_NAME&#34;  || ', ' || &#34;TOWN&#34; AS displaytext,
                    &#34;SITE_NAME&#34; AS search_part_1,
                    geom AS geom
                FROM local_authority.&#34;StreetGazetteerRecords&#34;
                /* ===================================== */
            )
            SELECT
                (array_to_json(array_append(ARRAY[subclass::text], id_in_class::text)))::text AS id,
                displaytext AS display,
                search_part_1 AS search_1_stem,
                search_part_1 AS sort,
                subclass AS facet,
                'trdc' AS tenant,
                (array_to_json(array_append(ARRAY[id_name::text], id_type::text)))::text AS idfield_meta,
                (st_asgeojson(st_envelope(geom), 0, 1)::json -> 'bbox')::text AS bbox,
                st_srid(geom) as srid
            FROM index_base">
        </entity>      
    </document>
</dataConfig>
